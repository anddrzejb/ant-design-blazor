@namespace AntDesign
@inherits AntInputComponentBase<(double, double)>
@using Microsoft.AspNetCore.Components.Web
@* //TODO: consider using templates for edges to avoid repetition *@
<div class="@ClassMapper.Class" id="@Id" @ref="Ref">
    <div class="ant-multi-range-slider-track ant-multi-range-slider-track-1 @_focusClass" style="z-index: 899;@(_trackStyle+_focusStyle)" 
        tabindex="0"
        @onmousedown="OnRangeItemClick" 
        @onmousedown:stopPropagation
        @onkeydown="e => OnKeyDown(e, 0)"
        @onkeydown:stopPropagation
        @onkeydown:preventDefault
        >
        @if (!string.IsNullOrWhiteSpace(Description))
        {
            <div class="ant-multi-range-slider-track-description" style="@_customDescriptionStyle">
                @if (!string.IsNullOrEmpty(Icon))
                {
                    <Icon Type="@Icon"></Icon>
                }
                @Description
            </div>
        }
    </div>    
    @if (Parent.HasTooltip)
    {
        <Tooltip Title="@Parent.TipFormatter(_leftValue)" Style="display: inline;" Visible="_tooltipLeftVisible" ArrowPointAtCenter="true" OverlayClassName="ant-multi-range-slider-tooltip" Placement="@TooltipPlacement" @ref="_toolTipLeft">
            <Unbound>
                <div tabindex="0" 
                     class="ant-multi-range-slider-handle ant-multi-range-slider-handle-1@_attachedLeftHandleClass" 
                     role="slider" 
                     aria-disabled="@Disabled.ToString()" 
                     aria-valuenow="30" 
                     aria-valuemin="0" 
                     aria-valuemax="100" 
                     style="@(_leftHandleStyle+_leftFocusZIndex)" 
                     @ref="@context.Current" 
                     @onmousedown="e => OnMouseDownEdge(e, false)"
                     @onmousedown:stopPropagation
                     @onkeydown="e => OnKeyDown(e, RangeEdge.Left)"
                     @onkeydown:stopPropagation
                     @onkeydown:preventDefault
                     @ondblclick="e => OnDoubleClick(RangeEdge.Left)">@_leftHandleFill
                </div>
            </Unbound>
        </Tooltip>
        <Tooltip Title="@Parent.TipFormatter(_rightValue)" Style="display: inline;" Visible="_tooltipRightVisible" ArrowPointAtCenter="true" OverlayClassName="ant-multi-range-slider-tooltip" Placement="@TooltipPlacement" @ref="_toolTipRight">
            <Unbound>
                <div tabindex="0" 
                     class="ant-multi-range-slider-handle ant-multi-range-slider-handle-2@_attachedRightHandleClass" 
                     role="slider" 
                     aria-disabled="@Disabled.ToString()" 
                     aria-valuenow="30" 
                     aria-valuemin="0" 
                     aria-valuemax="100" 
                     style="@(_rightHandleStyle+_rightFocusZIndex)" 
                     @ref="@context.Current" 
                     @onmousedown="e => OnMouseDownEdge(e, true)"
                     @onmousedown:stopPropagation
                     @onkeydown="e => OnKeyDown(e, RangeEdge.Right)"
                     @onkeydown:stopPropagation
                     @onkeydown:preventDefault
                     @ondblclick="e => OnDoubleClick(RangeEdge.Right)">@_rightHandleFill
                </div>
            </Unbound>
        </Tooltip>
    }
    else
    {
        <div tabindex="0" 
             class="ant-multi-range-slider-handle ant-multi-range-slider-handle-1@_attachedLeftHandleClass" 
             role="slider" 
             aria-disabled="@Disabled.ToString()" 
             aria-valuenow="30" 
             aria-valuemin="@Parent.Min" 
             aria-valuemax="@Parent.Max" 
             style="@(_leftHandleStyle+_leftFocusZIndex)" 
             @ref="_leftHandle" 
             @onmousedown="e => OnMouseDownEdge(e, false)"
             @onmousedown:stopPropagation
             @onkeydown="e => OnKeyDown(e, RangeEdge.Left)"
             @onkeydown:stopPropagation
             @onkeydown:preventDefault
             @ondblclick="e => OnDoubleClick(RangeEdge.Left)">@_leftHandleFill
        </div>
        <div tabindex="0" 
             class="ant-multi-range-slider-handle ant-multi-range-slider-handle-2@_attachedRightHandleClass" 
             role="slider" 
             aria-disabled="@Disabled.ToString()" 
             aria-valuenow="30" 
             aria-valuemin="0" 
             aria-valuemax="100" 
             style="@(_rightHandleStyle+_rightFocusZIndex)" 
             @ref="_rightHandle" 
             @onmousedown="(e) => OnMouseDownEdge(e, true)"
             @onmousedown:stopPropagation
             @onkeydown="e => OnKeyDown(e, RangeEdge.Right)"
             @onkeydown:stopPropagation
             @onkeydown:preventDefault
             @ondblclick="e => OnDoubleClick(RangeEdge.Right)">@_rightHandleFill
        </div>
    }

</div>

@code {
    static RenderFragment _locked = @<Icon Type="lock" Theme="outline"/>;
    static RenderFragment _unlocked = @<Icon Type="unlock" Theme="outline"/>;

    RenderFragment _rightHandleFill;
    RenderFragment _leftHandleFill;
}