@namespace AntDesign
@inherits AntInputComponentBase<IEnumerable<(double, double)>>
@using Microsoft.AspNetCore.Components.Web
@using AntDesign.Core.Helpers
<div style="@(_overflow)" @ref="_scrollableAreaRef">
    <div class="@ClassMapper.Class" style="@(_trackSize + @Style)" id="@Id" @ref="Ref">
        <div class="ant-multi-range-slider-rail" @ref=@_railRef style="@_railStyle">
        </div>
    
        <div class="ant-multi-range-slider-step">
            @if (Marks != null)
            {
                @foreach (RangeItemMark mark in Marks)
                {
                    <span style="position: absolute;@($"{GetBasePosition()}: {SetMarkPosition(mark.Key)};")">
                        @*<span class="ant-multi-range-slider-dot ant-multi-range-slider-dot-first"></span>
                        <span class="ant-multi-range-slider-dot ant-multi-range-slider-dot-second"></span>*@
                        <span class="ant-multi-range-slider-dot-line-dot"></span>
                    </span>
                }
            }
        </div>

        <CascadingValue Value="@this" Name="Range" IsFixed>
            @if (ChildContent != null)
            {        
                @ChildContent
            }
            else
            {
                @* //TODO: apply data source approach, test changing data source after initialization *@
                int i = 0;
                foreach(var rangeItemValue in Value)
                {
                    int iterator = i;
                    <RangeItem Value="@rangeItemValue" ValueChanged="(v) => RangeItemValueChanged(iterator, v)"/>    
                    i++;
                }
            }
        </CascadingValue>
        <div class="ant-multi-range-slider-mark">
            @if (Marks != null)
            {
                @foreach (RangeItemMark mark in Marks)
                {
                    <span class="ant-multi-range-slider-mark-text ant-multi-range-slider-mark-text-active" 
                          style=@($"{GetBasePosition()}: {SetMarkPosition(mark.Key)}; {(Vertical ? "margin-bottom: -50%;" : "transform: translateX(-50%);")}" + mark.Style)>
                          @mark.Value
                    </span>
                }
            }
        </div>
    </div>
</div>
